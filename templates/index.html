<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <title>Picture Frame</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="icon" type="image/x-icon" href="static\heart.ico">
</head>

<body class="bg-light">

    <div class="container mt-5">
        <h3 class="mb-4">Gerador de Imagem üíñ</h3>

        {% if message %}
        <div class="alert alert-success alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
        {% endif %}

        <form method="POST" enctype="multipart/form-data" class="card p-4 shadow-sm">
            <!-- Campo oculto para manter o nome da foto entre requests -->
            <input type="hidden" name="cached_foto" value="{{ cached_foto }}">

            <div class="mb-3">
                <label class="form-label">Foto</label>
                <input type="file" name="foto" class="form-control" {% if not cached_foto %}required{% endif %}>
                {% if cached_foto %}
                    <small class="text-muted">Foto atual: {{ cached_foto }} (envie outra para alterar)</small>
                {% endif %}
            </div>

            <div class="mb-3">
                <label class="form-label">Mensagem principal</label>
                <input type="text" name="frase_superior" maxlength="30" class="form-control" value="{{ frase_superior }}" required>
            </div>

            <div class="mb-3">
                <label class="form-label">Submensagem</label>
                <input type="text" name="frase_inferior" maxlength="30" class="form-control" value="{{ frase_inferior }}" required>
            </div>

            <div class="form-check form-switch mb-3">
                <input class="form-check-input" type="checkbox" name="dark_mode" id="dark" {% if dark_mode %}checked{% endif %}>
                <label class="form-check-label" for="dark">Dark mode</label>
            </div>

            <hr class="my-4">

            <div class="row align-items-end">
                <div class="col-md-6 mb-3">
                    <label class="form-label fw-bold">üìÖ Agendamento (Opcional)</label>
                    <input type="datetime-local" name="schedule_time" class="form-control"
                        value="{{ schedule_time }}">
                    <small class="text-muted">Deixe em branco para enviar agora.</small>
                </div>

                <div class="col-md-6 mb-3 d-flex gap-2 justify-content-end">
                    <button type="submit" name="action" value="preview" class="btn btn-primary w-100">
                        üé® Generate Preview
                    </button>
                </div>
            </div>

            {% if image_url %}
            <div class="mt-4 text-center">
                <h5>{% if preview_mode %}Preview{% else %}Resultado Final{% endif %}</h5>
                <img src="{{ image_url }}?{{ range(1000)|random }}" class="img-fluid rounded shadow">
                
                <div class="mt-3 d-flex justify-content-center gap-2">
                    <button type="submit" name="action" value="schedule" class="btn btn-outline-primary">
                        ‚è±Ô∏è Confirmar Agendamento
                    </button>
                    <button type="submit" name="action" value="instant" class="btn btn-success">
                        üöÄ Enviar Agora
                    </button>
                    <a href="{{ image_url }}" download class="btn btn-outline-secondary">
                        Baixar
                    </a>
                </div>
            </div>
            {% endif %}
        </form>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>